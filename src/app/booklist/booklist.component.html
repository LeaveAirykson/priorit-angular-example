<!-- titlebar -->
<div class="w-full flex flex-col gap-2 mb-4 sm:flex-row sm:justify-between items-center">
  <h1 class="mb-0">Verzeichnis</h1>
  <div class="button-group">
    <button (click)="showAddForm()" class="button button-primary">
      <span class="icon">post_add</span>
      Buch eintragen
    </button>
    <button type="button" class="button">
      <span class="icon text-blue-600">bar_chart</span>
      Visualisierung
    </button>
  </div>
</div>

<!-- filter and search -->
<div class="w-full flex flex-col flex-wrap gap-4 mb-4 xl:flex-row xl:flex-nowrap">
  <div class="inline-flex gap-2 flex-wrap items-center xl:w-full">
    <strong class="inline-flex items-center opacity-50 text-xs">
      <span class="icon">filter_alt</span>
      Filter
    </strong>
    <span class="flag" *ngFor="let filter of activeFilter">
      {{ filter.label }} <strong>{{ filter.value }}</strong>
    </span>
    <button class="button button-icon" (click)="showModal('filter')" title="Filter bearbeiten">
      <span class="icon">edit</span>
    </button>
  </div>
  <div class="w-full xl:w-auto">
    <input #searchfield value="{{searchterm}}" type="text" class="form-input form-input-small form-search md:min-w-96"
      placeholder="Suche nach Titel oder ISBN" (keydown.enter)="runSearch($event)">
  </div>
</div>

<!-- search and filter result notice -->
<ng-container *ngIf="searched">
  <div class="flex justify-center gap-2 items-center flex-wrap mb-4">
    <span>
      {{data.length ? data.length : 'Keine' }} Ergebnis(se) gefunden
      <span *ngIf="searchterm">für: '{{searchterm}}'</span>
    </span>
    <div class="button-group">
      <button class="button button-icon" title="zurücksetzen" (click)="reset()"><span class="icon">close</span></button>
      <button (click)="loadBooks()" class="button button-icon" title="Aktualisieren">
        <span class="icon">refresh</span>
      </button>
    </div>
  </div>
</ng-container>

<!-- books data table -->
<div class="datatable">
  <table>
    <thead class="whitespace-nowrap">
      <tr [sortable]="data" [column]="sort.column" [direction]="sort.direction" (sorted)="sort=$event">
        <th sortBy="title">Titel</th>
        <th sortBy="isbn">ISBN</th>
        <th sortBy="year">Jahr</th>
        <th sortBy="pagecount">Seitenanzahl</th>
        <th sortBy="language" class="text-right">Sprache</th>
        <th sortBy="ddc" class="text-right">Sachgruppe</th>
        <th sortBy="remuneration" class="text-right">Vergütungswert (€)</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let book of data">
        <td>{{ book.title }}</td>
        <td>{{ book.isbn }}</td>
        <td>{{ book.year }}</td>
        <td>{{ book.pagecount }}</td>
        <td class="text-right">{{ book.language }}</td>
        <td class="text-right">{{ book.ddc }}</td>
        <td class="text-right">{{ book.remuneration }}</td>
        <td class="text-right whitespace-nowrap">
          <button (click)="showAddForm(book.id)" type="button" class="button button-option" title="bearbeiten">
            <span class="icon">edit</span>
          </button>
          <button (click)="removeBook(book.id)" type="button" class="button button-option button-option-delete"
            title="löschen">
            <span class="icon">delete</span>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- filter modal -->
<app-modal *ngIf="modalVisible['filter']" (closing)="showModal('filter',false)">
  <app-bookfilterform width="400px" [filter]="filterData" (submit)="runFilter($event)"
    (cancel)="showModal('filter', false)"></app-bookfilterform>
</app-modal>

<!-- deletion modal -->
<app-modal *ngIf="markedForRemoval" (closing)="markForRemoval()">
  <div class="text-center mb-2"><strong>"{{markedForRemoval.title}}"</strong> wirklich löschen?</div>
  <div class="button-group w-full items-center justify-center">
    <button (click)="removeBook(markedForRemoval.id)" class="button button-primary">Löschen</button>
    <button (click)="markForRemoval()" class="button">Abbrechen</button>
  </div>
</app-modal>

<!-- edit/add form modal -->
<app-modal *ngIf="modalVisible['edit']" maxWidth="800px" (closing)="hideAddForm()">
  <app-bookform [id]="editId" (submit)="saveBook($event)" (cancel)="hideAddForm()"
    [validateIsbnChecksum]="overrides['validateIsbnChecksum']"></app-bookform>
</app-modal>